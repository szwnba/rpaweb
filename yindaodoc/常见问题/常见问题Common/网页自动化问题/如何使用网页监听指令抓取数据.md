# 使用网页监听指令抓取数据

## 问题描述

在网页上抓取数据时遇到某些图表数据无法抓取，但在开发者模式的 Network-response 中可以找到需要的数据，可使用监听网页请求指令获取目标数据（Chrome浏览器需将影刀插件升级到1.1）。

![](../img/如何使用网页监听指令抓取数据1597643771488-6e08c3fd-1d49-41be-951c-1a80ad4184c5.png)

![](../img/如何使用网页监听指令抓取数据1597643776196-514912ba-d535-4ad2-9bd8-adfc43bf6df5.png)

## 操作步骤

第一步、找到目标数据所在的url；

1. 打开目标数据所在网页（以下简称“网页”），按下 F12 打开开发者模式；

2. 按下 ctrl + R 重新加载；

3. 点击左侧的路径依次寻找其 response 中是否存在目标数据；

   ![](../img/如何使用网页监听指令抓取数据1597643810331-075e332e-81ac-4d72-8fde-459114dfc2bb.png)

4. 若存在目标数据，复制其url中不变的部分（一般日期时间或ID等是会变化的部分）

   ![](../img/如何使用网页监听指令抓取数据1597643838311-ab28e4ab-770f-4763-9ef1-6105da63f992.png)

第二步、监听第一步所获得的 URL；

1. 监听步骤

   获取网页对象-开始监听请求-跳转至新网址（重新加载）-延迟执行（等待加载完成）-获取网页监听结果（获取第一步中得到的URL的监听结果）-停止监听网页请求。

2. 流程实例

   示例流程与相关参数配置如下（此处获取获取已打开的网页对象即为第一步中的目标数据所在网页，也可用打开网页指令去获取目标网页对象）。

   流程：

   ![](../img/如何使用网页监听指令抓取数据1597643846718-ea487efb-9a87-4418-bdab-b4f925b22998.png)

   ![](../img/如何使用网页监听指令抓取数据1597643862720-080dce77-e548-4d64-8368-ec2950fb864b.png)

   ![](../img/如何使用网页监听指令抓取数据1597643866733-a393193b-b83d-418e-9b24-cecc0a14711f.png)![](../img/如何使用网页监听指令抓取数据1597643878133-77f2b724-1f96-430f-a565-441ddc712c3e.png)

第三步、获取目标数据；

1. 循环获取的 response_body_list ；

   流程：

   ![](../img/如何使用网页监听指令抓取数据1597643903694-ff4959cd-2506-4d3e-b79c-42d5ca252a49.png)

2. 转换数据格式：循环项是一个包含目标 url 各项数据的字典，response 内的数据包含在循环项字典的键[“body”] 中，body 是一个字符串，转化成 json 对象后即可对其中的数据进行提取。

   ![](../img/如何使用网页监听指令抓取数据1597644015018-784fc4f0-f914-4874-b746-a566b9915f26.png)

   ![](../img/如何使用网页监听指令抓取数据1597643917136-49fa1dcb-e15c-441e-aff0-c91a014f92fd.png)
   
3. 提取 json 对象中的目标信息(可将打印出的 json 文本复制至网站 json.cn 中观察数据结构，便于数据提取)；

   ![](../img/如何使用网页监听指令抓取数据1597643950761-037c0117-d7c8-4c82-8fe4-1cd569242450.png)

   ![](../img/如何使用网页监听指令抓取数据1597643985711-5860a304-1dbf-400f-bd0f-3b3f9dd83aa5.png)

   ![](../img/如何使用网页监听指令抓取数据1597643993085-5dcdb621-60c2-4846-86c2-a2361e964a5c.png)

