<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>UB语言参考_UiBot开发者指南</title>
    <link rel="stylesheet" href="../../tutorials/css/bootstrap.min-1.css">
    <link rel="stylesheet" href="styles/tpl.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-fixed navbar-dark bg-primary">
    <a class="navbar-brand pd0" href="#"><img src="https://forum.uibot.com.cn/view/img/logo.png" class="logo"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>

    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
            <li class="nav-item ">
                <a class="nav-link" href="//www.uibot.com.cn" target="_blank">官网 <span class="sr-only">(current)</span></a>
            </li>
           <li class="nav-item">
                <a class="nav-link" href="/guide/d1">初级开发者指南</a>
            </li>
            <li class="nav-item active">
                <a class="nav-link" href="/guide/d2">中级开发者指南</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="//docs.uibot.com.cn/" target="_blank">命令手册</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="//forum.uibot.com.cn" target="_blank">开发者社区</a>
            </li>
        </ul>
    </div>
</nav>
<div class="container-fluid">
    <div class="row flex-xl-nowrap">
        <div class="col-12 col-md-3 col-xl-2 bd-sidebar">
            <nav class="bd-links">
                <!--<h1 id="toc-title">UiBot开发者指南</h1>-->
                <ol class="toc"><li id="toc-li-2"><a href="ch002-1.html?version=0.8831020878128951#预备知识"><span class="section-header-number">1</span> 预备知识</a></li><li id="toc-li-5"><a href="ch003-1.html?version=0.8831020878128951#数据获取和处理"><span class="section-header-number">2</span> 数据获取和处理</a></li><li id="toc-li-20"><a href="ch004-1.html?version=0.8831020878128951#网络和系统操作"><span class="section-header-number">3</span> 网络和系统操作</a></li><li id="toc-li-31"><a href="ch005-1.html?version=0.8831020878128951#多流程协作"><span class="section-header-number">4</span> 多流程协作</a></li><li id="toc-li-37"><a href="ch006-1.html?version=0.8831020878128951#人工智能功能"><span class="section-header-number">5</span> 人工智能功能</a></li><li id="toc-li-43"><a href="ch007-1.html?version=0.8831020878128951#ub语言参考"><span class="section-header-number">6</span> UB语言参考</a><ol class="toc"><li id="toc-li-44"><a href="ch007-1.html?version=0.8831020878128951#概述"><span class="section-header-number">6.1</span> 概述</a></li><li id="toc-li-45"><a href="ch007-1.html?version=0.8831020878128951#基本结构"><span class="section-header-number">6.2</span> 基本结构</a></li><li id="toc-li-46"><a href="ch007-1.html?version=0.8831020878128951#变量常量和数据类型"><span class="section-header-number">6.3</span> 变量、常量和数据类型</a><ol class="toc"><li id="toc-li-47"><a href="ch007-1.html?version=0.8831020878128951#数据类型"><span class="section-header-number">6.3.1</span> 数据类型</a></li><li id="toc-li-48"><a href="ch007-1.html?version=0.8831020878128951#变量和常量"><span class="section-header-number">6.3.2</span> 变量和常量</a></li><li id="toc-li-49"><a href="ch007-1.html?version=0.8831020878128951#复合类型"><span class="section-header-number">6.3.3</span> 复合类型</a></li></ol></li><li id="toc-li-50"><a href="ch007-1.html?version=0.8831020878128951#运算符和表达式"><span class="section-header-number">6.4</span> 运算符和表达式</a></li><li id="toc-li-51"><a href="ch007-1.html?version=0.8831020878128951#逻辑语句"><span class="section-header-number">6.5</span> 逻辑语句</a><ol class="toc"><li id="toc-li-52"><a href="ch007-1.html?version=0.8831020878128951#条件分支语句"><span class="section-header-number">6.5.1</span> 条件分支语句</a></li><li id="toc-li-53"><a href="ch007-1.html?version=0.8831020878128951#选择分支语句"><span class="section-header-number">6.5.2</span> 选择分支语句</a></li><li id="toc-li-54"><a href="ch007-1.html?version=0.8831020878128951#条件循环语句"><span class="section-header-number">6.5.3</span> 条件循环语句</a></li><li id="toc-li-55"><a href="ch007-1.html?version=0.8831020878128951#计次循环语句"><span class="section-header-number">6.5.4</span> 计次循环语句</a></li><li id="toc-li-56"><a href="ch007-1.html?version=0.8831020878128951#遍历循环语句"><span class="section-header-number">6.5.5</span> 遍历循环语句</a></li><li id="toc-li-57"><a href="ch007-1.html?version=0.8831020878128951#跳出语句"><span class="section-header-number">6.5.6</span> 跳出语句</a></li></ol></li><li id="toc-li-58"><a href="ch007-1.html?version=0.8831020878128951#函数"><span class="section-header-number">6.6</span> 函数</a></li><li id="toc-li-59"><a href="ch007-1.html?version=0.8831020878128951#其他"><span class="section-header-number">6.7</span> 其他</a><ol class="toc"><li id="toc-li-60"><a href="ch007-1.html?version=0.8831020878128951#多模块"><span class="section-header-number">6.7.1</span> 多模块</a></li><li id="toc-li-61"><a href="ch007-1.html?version=0.8831020878128951#异常"><span class="section-header-number">6.7.2</span> 异常</a></li></ol></li></ol></li><li id="toc-li-62"><a href="ch008-1.html?version=0.8831020878128951#高级开发功能"><span class="section-header-number">7</span> 高级开发功能</a></li><li id="toc-li-73"><a href="ch009-1.html?version=0.8831020878128951#扩展uibot命令"><span class="section-header-number">8</span> 扩展UiBot命令</a></li></ol>
            </nav>
        </div>
        <div class="col-12 col-md-9 col-xl-10 bd-content">
            
<section class="level1" id="ub语言参考">
<h1><span class="header-section-number">6</span> UB语言参考</h1>
<p>除了可视化视图之外，还有很多用户喜欢使用UiBot的源代码视图来编写一个流程块。源代码视图使用一种UiBot自创的编程语言BotScript（以下简称UB语言）来描述流程块。在这一章，我们先学习UB语言的基本规则，为后面学习源代码视图打下基础。</p>
<p>本章需要读者有一点点编程基础，任何编程语言都可以，只要了解变量、函数等基本概念即可。如果完全没有基础，请先阅读初级开发者指南的附录部分，以便快速入门。</p>
<section class="level2" id="概述">
<h2><span class="header-section-number">6.1</span> 概述</h2>
<p>前文提到，UiBot的设计理念是“强大”、“简单”、“快捷”。简言之，UiBot既要让没有计算机基础的初学者，通过简单的学习，即可快速掌握流程的编写方法；又要让有一定编程基础的专业人员，能够以最快的速度实现自己的流程。</p>
<p>为了实现这些指标，UiBot提供了可视化的流程编写界面，便于初学者快速掌握；同时提供了一种简单、易学、接近自然语言的UB编程语言，便于专业人员的快速实现。当然，同一个流程块，可以用两种界面来显示，并可以在开发过程中随时切换。</p>
<p>这一章主要介绍UB语言的基本语法规则。具有基本编程基础的读者，大约在两小时内即可掌握此规则，再经过数个小时的熟悉，即可灵活运用。对于有按键精灵基础的读者，还能进一步缩短学习时间。</p>
<p>对于UiBot来说，编程语言只是表达逻辑的工具，关键的功能还是由命令库或插件来实现。所以，语言设计只包括基本的逻辑，所有具体的功能，哪怕是最基本的“延时”功能，都不列入语言设计中，而在命令库中单独设计。本章内容亦不包命令库的介绍。</p>
<p>UB语言是专门设计的，而不是市面上流行的编程语言如Python、JavaScript等，是因为UiBot的主要受众是那些非计算机专业科班出身，但足够熟悉业务流程的非技术人员。UB语言的设计尽可能的接近自然语言，对于理解基本英文单词的人来说，即使没有学习过，也能大致读懂。</p>
<p>相比之下，以JavaScript为例，虽然JavaScript是一种很优秀的语言，在专业的程序员手里能发挥出很高的效率，甚至UiBot本身都有一部分代码是使用JavaScript编写的。但这种语言里面大量使用的括号，容易给非专业人员的学习带来障碍。如下图：</p>
<figure>
<img alt="复杂的JavaScript" src="../../doc/guide/d2/media/file112.png" style="width:80.0%"><figcaption>复杂的JavaScript</figcaption>
</figure>
<p>因此，我们设计了专门的UB语言，并使这门语言尽可能简化，甚至尽可能少用除了字母和数字之外的元素。实际上，我们也考虑过使用市面上流行的编程语言的可能性，因为如果这样做，我们的开发UiBot的工作量会大大降低，但与此同时，您的学习难度则会大大提高。所以，我们否定了这种思路，决定不采用流行的编程语言如Python等，非不能也，是不为也。</p>
<p>但是，在UB语言中，吸取了很多其他编程语言的优点。您会在UB语言的设计中看到Basic语言、Python语言、JavaScript语言的一些特点。因为我们在充分理解的基础上，博取众家之长，吸取最容易理解且常用的部分，删去复杂、不常用的部分，使UB语言精简、简单、易学、易用。</p>
<p>我们认为UB语言是目前最适合RPA领域的编程语言。</p>
</section>
<section class="level2" id="基本结构">
<h2><span class="header-section-number">6.2</span> 基本结构</h2>
<p>UB语言的源代码文件是纯文本格式，扩展名不限，一律采用UTF-8编码。</p>
<p>UB语言的源代码由多条语句组成，和一般的脚本型语言，如Python、JavaScript等一样，UB语言并没有严格的结构和显式指定的入口。执行一个流程块的时候，从第一行开始执行，遇到函数定义暂时跳过，然后继续从函数结束后的一行开始执行（函数的概念请参考<a href="ch007-2.html#函数">这里</a>）。</p>
<p>一般来说，我们推荐一行只写一个语句。如果一定要写多个语句，则用冒号分隔符（:）进行分隔。</p>
<p>如果一行内容不够，需要折行，可以在任意语句中出现的逗号（<strong><code>,</code></strong>）或二元运算符（“二元运算符”的概念请参考<a href="ch007-2.html#运算符和表达式">这里</a>）之后直接折行，不需要增加其他额外的符号，也不推荐在其他地方折行。但如果一定要在其他地方折行，则用反斜杠（<strong><code>\</code></strong>）作为折行符号。例如：</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb1-1" title="1">Dim a= \</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="dv">1</span></a></code></pre></div>
<p>当一行中存在 <strong><code>//</code></strong> 时，表示从这以后的内容都是注释。包含在 <strong><code>/*   */</code></strong> 中的内容，无论多少行，都视作注释。例如：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb2-1" title="1"><span class="co">// 这里是注释</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co">/*</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">这里</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">也是</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">注释</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">*/</span></a></code></pre></div>
<p>注释在流程运行过程中没有任何作用，仅供阅读方便。</p>
<p>UB语言中所有关键字、变量名、函数名均<strong>不区分大小写</strong>。例如：变量名abc、ABC或者Abc都被认为是同一个变量。</p>
</section>
<section class="level2" id="变量常量和数据类型">
<h2><span class="header-section-number">6.3</span> 变量、常量和数据类型</h2>
<section class="level3" id="数据类型">
<h3><span class="header-section-number">6.3.1</span> 数据类型</h3>
<p>变量是编程语言中最基础的功能，变量中可以存放数字、字符串等值，并且可以在运行的过程中，随时改变变量中的值。UB语言中的变量是动态类型的，即变量的值和类型都可以在运行过程中动态改变。这符合一般脚本型语言如Python、JavaScript的习惯。变量的类型分为以下几种：整数型、浮点数型、布尔型、字符串型、函数型、复合型和空值型。</p>
<p>整数型的值可以以十进制或者十六进制的方式表示，其中十六进制需加前缀 <strong><code>&amp;H</code></strong> 或 <strong><code>&amp;h</code></strong>。</p>
<p>浮点数的值可以用常规方式或者科学计数法方式表示。如 <strong><code>0.01</code></strong> 或者 <strong><code>1E-2</code></strong> 或者 <strong><code>1e-2</code></strong> 均代表同一个浮点数。</p>
<p>布尔型的值仅有 <strong><code>True</code></strong> 或者 <strong><code>False</code></strong>，两者皆不区分大小写。</p>
<p>字符串型的值用一对单引号（<strong><code>'</code></strong>）或一对双引号（<strong><code>"</code></strong>）所包围，字符串中可以用 <strong><code>\t</code></strong> 代表制表符，用 <strong><code>\n</code></strong> 代表换行，用 <strong><code>\'</code></strong> 代表单引号，用 <strong><code>\"</code></strong> 代表双引号，用 <strong><code>\\</code></strong> 代表反斜杠本身（这种表示方式称为“转义”）。字符串中间可以直接换行，无需增加任何其他符号，换行符也会作为字符串的一部分。</p>
<p>也可以用前后各三个单引号（<strong><code>'''</code></strong>）来表示一个字符串，这种字符串被称为长字符串。在长字符串中，可以直接写回车符、单引号和双引号，无需用 <strong><code>\n</code></strong>，<strong><code>\'</code></strong> 或者 <strong><code>\"</code></strong> 进行转义。</p>
<p>函数型的值只能是已经定义好的函数，在后文详述。</p>
<p>复合型的值包括数组、字典等，在下一节详细阐述。</p>
<p>空值型的值总是 <strong><code>Null</code></strong>，不区分大小写。</p>
<p>例如：</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb3-1" title="1">a <span class="op">=</span> <span class="dv">1</span>           <span class="op">//</span> a是整数型变量</a>
<a class="sourceLine" id="cb3-2" title="2">a <span class="op">=</span> <span class="op">&amp;</span>HFF        <span class="op">//</span> a还是整数型变量</a>
<a class="sourceLine" id="cb3-3" title="3">a <span class="op">=</span> <span class="va">True</span>        <span class="op">//</span> a是布尔型变量。作为动态类型语言，a的类型可以随时变化 </a>
<a class="sourceLine" id="cb3-4" title="4">a <span class="op">=</span> FALSE       <span class="op">//</span> a是布尔型变量，注意True和False都不区分大小写</a>
<a class="sourceLine" id="cb3-5" title="5">a <span class="op">=</span> <span class="st">'UiBot'</span>     <span class="op">//</span> a是字符串型变量</a>
<a class="sourceLine" id="cb3-6" title="6">a <span class="op">=</span> <span class="st">"UiBot</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="st">RPA"</span>            <span class="op">//</span> a是字符串型变量，字符串中可以换行</a>
<a class="sourceLine" id="cb3-8" title="8">a <span class="op">=</span> null        <span class="op">//</span> a是空值型变量，可以写为Null、NULL或null（不区分大小写）</a></code></pre></div>
</section>
<section class="level3" id="变量和常量">
<h3><span class="header-section-number">6.3.2</span> 变量和常量</h3>
<p>变量的定义方式是：</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb4-1" title="1">Dim 变量名</a></code></pre></div>
<p>定义变量名的同时，可以给变量赋值一个初始值：</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb5-1" title="1">Dim 变量名=值</a></code></pre></div>
<p>想要定义多个变量的话，可以这样定义：</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb6-1" title="1">Dim 变量名<span class="dv">1</span> = 值<span class="dv">1</span>, 变量名<span class="dv">2</span></a>
<a class="sourceLine" id="cb6-2" title="2">Dim 变量名<span class="dv">1</span> = 值<span class="dv">1</span>, 变量名<span class="dv">2</span> = 值<span class="dv">2</span></a></code></pre></div>
<p>常量的定义方式和变量类似，只是把Dim改为Const，并且必须在定义时就指定值：</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb7-1" title="1">Const 常量名=值, 常量名=值</a></code></pre></div>
<p>常量和变量的唯一区别是，常量只能在定义时指定一次值，后面不允许再修改。</p>
<p>例如：</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb8-1" title="1">Dim a               <span class="co">// 定义名为a的变量，暂不赋值</span></a>
<a class="sourceLine" id="cb8-2" title="2">Dim b = <span class="dv">1</span>           <span class="co">// 定义名为b的变量，并赋值为1 </span></a>
<a class="sourceLine" id="cb8-3" title="3">Dim c, d = True     <span class="co">// 定义名为c和d的两个变量，为d赋值True</span></a>
<a class="sourceLine" id="cb8-4" title="4">Const e = 'UiBot'   <span class="co">// 定义名为e的常量，为其赋值为字符串’UiBot’</span></a>
<a class="sourceLine" id="cb8-5" title="5">Const f             <span class="co">// 错误：常量必须有初始赋值</span></a></code></pre></div>
<p>对于有命名的变量、常量、函数等，其名字统称为标识符，标识符需要遵循一定规则定义。</p>
<p>标识符可以用英文字母、下划线（<strong><code>_</code></strong>），任意UTF-8编码中包含的除英语以外其他语言的字符（当然，也包括汉字）来表示，除了第一个字符外，后面还可以使用0-9的数字。当使用英文字母时，变量名不区分大小写。</p>
<p>UB语言推荐变量经过定义再使用（除了<code>For</code>语句中的循环变量、<code>Try</code>语句中的异常变量、函数参数等）。变量在函数范围内定义时，属于局部变量，在函数退出时即清空。在函数范围之外任何位置定义时，属于流程块级变量，在一个流程块的运行过程中都不会清空。流程块级变量可以定义在函数范围外任何位置，不影响其使用，甚至可以在使用变量之后定义。</p>
<p>如果变量未经定义而直接使用，UiBot也不会报错，但会有一个警告提示。这个警告能避免您在输入变量名时产生手误，比如把变量名 <code>cat</code> 误输入成为了 <code>cart</code>，通过警告信息，您就会发现 <code>cart</code> 是未经定义的，并进一步查出是因为手误所致。</p>
</section>
<section class="level3" id="复合类型">
<h3><span class="header-section-number">6.3.3</span> 复合类型</h3>
<p>除了常用的整数型、字符串型等简单数据类型之外，UiBot还支持两种复合类型：数组、字典。两者在定义时和简单数据类型变量的定义并无区别。</p>
<p>数组类型变量的表示方法为：使用小写方括号包围起来，使用逗号来分隔每个元素，和 VBScript 中的数组定义类似。范例：</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb9-1" title="1">Dim 数组变量 = [值<span class="dv">1</span>, 值<span class="dv">2</span>, 值<span class="dv">3</span>, 值<span class="dv">4</span>]</a></code></pre></div>
<p>同一个数组中的多个元素的值可以是任意类型，例如：元素的值是整数，就构成一个整数数组；同一个数组中的多个元素也可以是不同类型，例如：第一个元素是整数，第二个元素是字符串等；甚至，一个数组中的元素也可以是另外一个数组，这样就构成了一般意义上的多维数组。范例：</p>
<p>Dim 数组变量 = [值 1, 值 2, [值 11, 值 22], 值 4]</p>
<p>字典类型变量的表示方法为：使用大括号来包围起来，名字和其对应的值为一对，用逗号分隔。范例：</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb10-1" title="1">{ 名字<span class="dv">1</span>:值<span class="dv">1</span>, 名字<span class="dv">2</span>:值<span class="dv">2</span>, 名字<span class="dv">3</span>:值<span class="dv">3</span> }</a></code></pre></div>
<p>其中 <strong>名字</strong> 只能是字符串，<strong>值</strong> 可以是任意类型的表达式。如果您熟悉 JavaScript 或者 JSON，会发现这种初始化方法和 JSON 的表示形式高度相似。</p>
<p>数组和字典类型变量的使用方法为：无论是数组还是字典，要引用其中的元素，均采用方括号作为索引。范例：</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb11-1" title="1">变量名[索引1]</a></code></pre></div>
<p>使用这种方法引用数组或者字典中的元素，既可以作为左值也可以作为右值，也就是说，既可以读取该变量的值，也可以为该变量的内容赋值，甚至可以在其中增加新的值。范例：</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb12-1" title="1">Dim 变量 = [<span class="dv">486</span>, <span class="dv">557</span>, <span class="dv">256</span>]                      <span class="co">// 变量可以用中文命名，初值是一个数组</span></a>
<a class="sourceLine" id="cb12-2" title="2">a = 变量[<span class="dv">1</span>]                                     <span class="co">// 此时a被赋值为557</span></a>
<a class="sourceLine" id="cb12-3" title="3">变量 = {<span class="st">"key1"</span>:<span class="dv">486</span>, <span class="st">"key2"</span>:<span class="dv">557</span>, <span class="st">"key3"</span>:<span class="dv">256</span>}     <span class="co">// 变量的类型改为一个字典</span></a>
<a class="sourceLine" id="cb12-4" title="4">a = 变量[<span class="st">"key1"</span>]                                <span class="co">// 此时a被赋值为486</span></a></code></pre></div>
<p>注意：在引用数组或字典中的元素时，数组的索引只能是整数类型，用0作为起始索引；字典的索引只能是字符串类型。如果未能正确的使用，会在运行时报错。</p>
<p>数组或者字典的引用是可以嵌套的，如果要引用数组中的数组（即多维数组），或者字典中的数组，可以继续在后面写新的方括号。范例：</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb13-1" title="1">变量 = {<span class="st">"key1"</span>:<span class="dv">486</span>, <span class="st">"key2"</span>:<span class="dv">557</span>, <span class="st">"key3"</span>:<span class="dv">256</span>}     <span class="co">// 变量的类型为一个字典</span></a>
<a class="sourceLine" id="cb13-2" title="2">变量[<span class="st">"key4"</span>] = [<span class="dv">235</span>, <span class="dv">668</span>]                       <span class="co">// 往字典中增加一个新值，该值是一个数组</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">//此时，字典中的内容为 {"key1":486, "key2":557, "key3":256, "key4":[235, 668]}</span></a>
<a class="sourceLine" id="cb13-4" title="4">a = 变量[<span class="st">"key4"</span>][<span class="dv">0</span>]                             <span class="co">// 此时a被赋值为235</span></a></code></pre></div>
</section>
</section>
<section class="level2" id="运算符和表达式">
<h2><span class="header-section-number">6.4</span> 运算符和表达式</h2>
<p>UB语言中的运算符及其含义如下表：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">+</th>
<th style="text-align: center;">-</th>
<th style="text-align: center;">*</th>
<th style="text-align: center;">/</th>
<th style="text-align: center;">&amp;</th>
<th style="text-align: center;">^</th>
<th style="text-align: center;">&lt;</th>
<th style="text-align: center;">&lt;=</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">加法</td>
<td style="text-align: center;">减法/求负</td>
<td style="text-align: center;">乘法</td>
<td style="text-align: center;">除法</td>
<td style="text-align: center;">连接字符串</td>
<td style="text-align: center;">求幂</td>
<td style="text-align: center;">小于</td>
<td style="text-align: center;">小于等于</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">&gt;</th>
<th style="text-align: center;">&gt;=</th>
<th style="text-align: center;">&lt;&gt;</th>
<th style="text-align: center;">=</th>
<th style="text-align: center;">And</th>
<th style="text-align: center;">Or</th>
<th style="text-align: center;">Not</th>
<th style="text-align: center;">Mod</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">大于</td>
<td style="text-align: center;">大于等于</td>
<td style="text-align: center;">不相等</td>
<td style="text-align: center;">相等/赋值</td>
<td style="text-align: center;">逻辑与</td>
<td style="text-align: center;">逻辑或</td>
<td style="text-align: center;">逻辑非</td>
<td style="text-align: center;">取余数</td>
</tr>
</tbody>
</table>
<p>把变量、常量和值用运算符和圆括号 <strong><code>( )</code></strong> 连接到一起，称为表达式。在上述运算符中，<strong><code>Not</code></strong> 是一元运算符、<strong><code>-</code></strong> 既可以用作一元运算符，也可以用作二元运算符，其他都是二元运算符。一元运算符只允许在右边出现一个元素（变量、常量、表达式或值），二元运算符只允许在左右两边同时出现两个元素。</p>
<p>注意：当 <strong><code>=</code></strong> 出现在表达式内部时，其含义是判断是否相等。当 <strong><code>=</code></strong> 构成一个独立的语句时，其含义是赋值。这里 <strong><code>=</code></strong> 的设计虽然具有二义性，但能更好的被初学者所接受。</p>
<p>UB语言中删掉一些其他语言中具备、但不常用的运算符，如整数除运算符、位操作运算符等等。因为这些运算符的使用场景较少，即使需要，也可以采用其他方式实现。</p>
<p>表达式常用于赋值语句，可以给某个变量赋值，其形式为：</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb14-1" title="1">变量名 = 表达式</a></code></pre></div>
<p>注意，当表达式为一个独立的（没有使用任何运算符计算）数组、字典类型的变量时，赋值操作只赋值其引用，也就是说，只是为这个变量增加一个“别名”。当一个数组、字典中的元素发生改变时，另一个也会改变。</p>
<p>例如：</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb15-1" title="1">a = [<span class="dv">486</span>, <span class="dv">557</span>, <span class="dv">256</span>]     <span class="co">// a是一个数组</span></a>
<a class="sourceLine" id="cb15-2" title="2">b = a                   <span class="co">// b是a的“别名”</span></a>
<a class="sourceLine" id="cb15-3" title="3">b[<span class="dv">1</span>] = <span class="dv">558</span>              <span class="co">// 改变b里面的值，a里面的值也会跟着改变</span></a>
<a class="sourceLine" id="cb15-4" title="4">c = a[<span class="dv">1</span>]                <span class="co">// 此时c的值是558，而不是原来的557</span></a>
<a class="sourceLine" id="cb15-5" title="5">a = <span class="dv">557</span>                 <span class="co">// 此时a被赋值为557（变为整数型）</span></a>
<a class="sourceLine" id="cb15-6" title="6">b = a                   <span class="co">// 此时b里面的值也是557，但和a分别保存</span></a>
<a class="sourceLine" id="cb15-7" title="7">b = <span class="dv">558</span>                 <span class="co">// b里面的值发生改变，a的值不改变</span></a>
<a class="sourceLine" id="cb15-8" title="8">c = a                   <span class="co">// 此时c的值仍然是原来的557，因为a不是字典、数组</span></a></code></pre></div>
</section>
<section class="level2" id="逻辑语句">
<h2><span class="header-section-number">6.5</span> 逻辑语句</h2>
<section class="level3" id="条件分支语句">
<h3><span class="header-section-number">6.5.1</span> 条件分支语句</h3>
<p>即一般编程语言中最常用的If…Else语句，主要用于对某一个或者多个条件进行判断，从而执行不同流程。在UB语言中，有以下几种形式：</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb16-1" title="1">If 条件</a>
<a class="sourceLine" id="cb16-2" title="2">    语句块<span class="dv">1</span></a>
<a class="sourceLine" id="cb16-3" title="3">End If</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb17-1" title="1">If 条件</a>
<a class="sourceLine" id="cb17-2" title="2">    语句块<span class="dv">1</span></a>
<a class="sourceLine" id="cb17-3" title="3">Else</a>
<a class="sourceLine" id="cb17-4" title="4">    语句块<span class="dv">2</span></a>
<a class="sourceLine" id="cb17-5" title="5">End If</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb18-1" title="1">If 条件<span class="dv">1</span></a>
<a class="sourceLine" id="cb18-2" title="2">    语句块<span class="dv">1</span></a>
<a class="sourceLine" id="cb18-3" title="3">ElseIf 条件<span class="dv">2</span></a>
<a class="sourceLine" id="cb18-4" title="4">    语句块<span class="dv">2</span></a>
<a class="sourceLine" id="cb18-5" title="5">Else</a>
<a class="sourceLine" id="cb18-6" title="6">    语句块<span class="dv">3</span></a>
<a class="sourceLine" id="cb18-7" title="7">End If</a></code></pre></div>
<p>当条件满足时，会执行条件之后的语句块，否则，语句块不会执行。<code>Else</code>后面的语句块则会在前面所有条件都不满足的时候，才会执行。</p>
<p>例如：</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb19-1" title="1"><span class="co">// Time.Hour() 可以取得当前时间中的小时数</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="co">// TracePrint() 可以把指定的内容输出到UiBot的输出栏中</span></a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4">If Time.Hour() &gt; <span class="dv">18</span>             <span class="co">// 取得当前时间中的小时数</span></a>
<a class="sourceLine" id="cb19-5" title="5">    TracePrint(<span class="st">"下班时间"</span>)      <span class="co">// 如果大于18，则执行这里的语句</span></a>
<a class="sourceLine" id="cb19-6" title="6">Else</a>
<a class="sourceLine" id="cb19-7" title="7">    TracePrint(<span class="st">"上班时间"</span>)      <span class="co">// 如果不满足前面的条件，则执行这里的语句</span></a>
<a class="sourceLine" id="cb19-8" title="8">End If</a></code></pre></div>
</section>
<section class="level3" id="选择分支语句">
<h3><span class="header-section-number">6.5.2</span> 选择分支语句</h3>
<p>根据一定的条件，选择多个分支中的一个。先计算<code>Select Case</code>后面的<code>表达式</code>，然后判断是否有某个<code>Case</code>分支和这个<code>表达式</code>的值是一致的。如果没有一致的<code>Case</code>分支，则执行<code>Case Else</code>（如果有）后面的语句块。</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb20-1" title="1">Select Case 表达式</a>
<a class="sourceLine" id="cb20-2" title="2">    Case 表达式1, 表达式2</a>
<a class="sourceLine" id="cb20-3" title="3">        语句块<span class="dv">1</span></a>
<a class="sourceLine" id="cb20-4" title="4">    Case 表达式3, 表达式4</a>
<a class="sourceLine" id="cb20-5" title="5">        语句块<span class="dv">2</span></a>
<a class="sourceLine" id="cb20-6" title="6">    Case Else</a>
<a class="sourceLine" id="cb20-7" title="7">        语句块<span class="dv">3</span></a>
<a class="sourceLine" id="cb20-8" title="8">End Select</a></code></pre></div>
<p>例如：</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb21-1" title="1">Select Case Time.Month()            <span class="co">// 取得当前时间中的月份</span></a>
<a class="sourceLine" id="cb21-2" title="2">    Case <span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">12</span>            <span class="co">// 如果是1、3、5、7、8、10、12月</span></a>
<a class="sourceLine" id="cb21-3" title="3">        DayOfMonth = <span class="dv">31</span>             <span class="co">// 当月有31天</span></a>
<a class="sourceLine" id="cb21-4" title="4">    Case <span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">9</span>,<span class="dv">11</span>                   <span class="co">// 如果是4、6、9、11月</span></a>
<a class="sourceLine" id="cb21-5" title="5">        DayOfMonth = <span class="dv">30</span>             <span class="co">// 当月有30天</span></a>
<a class="sourceLine" id="cb21-6" title="6">    Case Else                       <span class="co">// 如果是其他（也就是2月）</span></a>
<a class="sourceLine" id="cb21-7" title="7">        DayOfMonth = <span class="dv">28</span>             <span class="co">// 当月有28天（不考虑闰年的情况）</span></a>
<a class="sourceLine" id="cb21-8" title="8">End Select</a>
<a class="sourceLine" id="cb21-9" title="9">TracePrint(DayOfMonth)</a></code></pre></div>
</section>
<section class="level3" id="条件循环语句">
<h3><span class="header-section-number">6.5.3</span> 条件循环语句</h3>
<p>在UB语言中，使用<code>Do…Loop</code>语句来实现条件循环，即满足一定条件时，循环执行某一语句块。<code>Do…Loop</code>语句有以下五种不同的形式，用法较为灵活：</p>
<ol type="1">
<li><strong>前置条件成立</strong>则循环：先判断<code>条件</code>，<code>条件</code>成立则循环执行语句块，否则自动退出循环。</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb22-1" title="1">Do While 条件</a>
<a class="sourceLine" id="cb22-2" title="2">    语句块</a>
<a class="sourceLine" id="cb22-3" title="3">Loop</a></code></pre></div>
<ol start="2" type="1">
<li><strong>前置条件不成立</strong>则循环：和前一条相反，<code>条件</code>成立则退出循环，否则循环执行语句块。</li>
</ol>
<div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb23-1" title="1">Do Until 条件</a>
<a class="sourceLine" id="cb23-2" title="2">    语句块</a>
<a class="sourceLine" id="cb23-3" title="3">Loop</a></code></pre></div>
<ol start="3" type="1">
<li><strong>后置条件成立</strong>则循环：先执行语句块，再判断<code>条件</code>，<code>条件</code>成立则继续循环执行语句块，否则自动退出循环。</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb24-1" title="1">Do</a>
<a class="sourceLine" id="cb24-2" title="2">    语句块</a>
<a class="sourceLine" id="cb24-3" title="3">Loop While 条件</a></code></pre></div>
<ol start="4" type="1">
<li><strong>后置条件不成立</strong>则循环：先执行语句块，再判断<code>条件</code>，<code>条件</code>成立则自动退出循环，否则继续循环执行语句块。</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb25-1" title="1">Do </a>
<a class="sourceLine" id="cb25-2" title="2">    语句块</a>
<a class="sourceLine" id="cb25-3" title="3">Loop Until 条件</a></code></pre></div>
<ol start="5" type="1">
<li><strong>无限</strong>循环：该循环语句本身不进行任何条件的判断，需要在语句块中自行做判断，如果语句块中没有跳出循环的语句，则会无限的执行该循环</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb26-1" title="1">Do</a>
<a class="sourceLine" id="cb26-2" title="2">    语句块</a>
<a class="sourceLine" id="cb26-3" title="3">Loop</a></code></pre></div>
<p>例如：</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb27-1" title="1">Do Until Time.Hour() &gt; <span class="dv">18</span>              <span class="co">// 判断当前时间中的小时数，只要不大于18就循环</span></a>
<a class="sourceLine" id="cb27-2" title="2">    TracePrint(<span class="st">"还没有到下班时间"</span>)      <span class="co">// 每次循环，都会执行这里的语句</span></a>
<a class="sourceLine" id="cb27-3" title="3">    Delay(<span class="dv">1000</span>)                        <span class="co">// 每判断一次，休息一秒钟</span></a>
<a class="sourceLine" id="cb27-4" title="4">Loop</a>
<a class="sourceLine" id="cb27-5" title="5">TracePrint(<span class="st">"下班时间到啦"</span>)              <span class="co">// 如果大于18，则跳出循环，执行这里的语句</span></a></code></pre></div>
</section>
<section class="level3" id="计次循环语句">
<h3><span class="header-section-number">6.5.4</span> 计次循环语句</h3>
<p>计次循环语句主要用于执行一定次数的循环，其基本形式为：</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb28-1" title="1">For 循环变量 = 起始值 To 结束值 Step 步长</a>
<a class="sourceLine" id="cb28-2" title="2">    语句块</a>
<a class="sourceLine" id="cb28-3" title="3">Next</a></code></pre></div>
<p>在计次循环语句中，<code>起始值</code>、<code>结束值</code>、<code>步长</code>都只允许是整数型或者浮点数型；<code>步长</code>可以省略，默认值为1。变量从<code>起始值</code>开始，每循环一次自动增加<code>步长</code>，直到大于<code>结束值</code>，循环才会结束。</p>
<p>在计次循环语句中，<code>循环变量</code>可以不用<code>Dim</code>语句定义，直接使用，但在循环结束后就不能再使用了。</p>
<p>例如：</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb29-1" title="1">Dim count = <span class="dv">0</span>               <span class="co">// 定义变量count</span></a>
<a class="sourceLine" id="cb29-2" title="2">For i=<span class="dv">1</span> To <span class="dv">100</span>              <span class="co">// 每次循环，变量i都会加1。这里变量i不需要定义</span></a>
<a class="sourceLine" id="cb29-3" title="3">    count = count + i</a>
<a class="sourceLine" id="cb29-4" title="4">Next</a>
<a class="sourceLine" id="cb29-5" title="5">TracePrint(count)           <span class="co">// 这里会显示1+2+3+…+100的结果，即5050</span></a></code></pre></div>
</section>
<section class="level3" id="遍历循环语句">
<h3><span class="header-section-number">6.5.5</span> 遍历循环语句</h3>
<p>遍历循环语句可以用于处理数组、字典中的每一个元素。遍历循环语句有以下两种形式：</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb30-1" title="1">For Each 循环变量 In 数组或字典</a>
<a class="sourceLine" id="cb30-2" title="2">    语句块</a>
<a class="sourceLine" id="cb30-3" title="3">Next</a></code></pre></div>
<p>在这种形式的循环语句中，会自动遍历数组、字典中的每一个值，并将其置入<code>循环变量</code>中，直到遍历完成为止。</p>
<p>或者：</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb31-1" title="1">For Each 循环变量<span class="dv">1</span>, 循环变量<span class="dv">2</span> In 数组或字典</a>
<a class="sourceLine" id="cb31-2" title="2">    语句块</a>
<a class="sourceLine" id="cb31-3" title="3">Next</a></code></pre></div>
<p>在这种形式的循环语句中，会自动遍历数组、字典中的每一个索引和值，并将其分别置入<code>循环变量1</code>、<code>循环变量2</code>中，直到遍历完成为止。</p>
<p>和计次循环语句类似，在遍历循环语句中，<code>循环变量</code>可以不用<code>Dim</code>语句定义，直接使用，但在循环结束后就不能再使用了。</p>
<p>例如：</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb32-1" title="1">Dim days = [<span class="dv">31</span>, <span class="dv">28</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">30</span>, <span class="dv">31</span>] <span class="co">// 定义数组型变量days</span></a>
<a class="sourceLine" id="cb32-2" title="2">Dim count = <span class="dv">0</span>   </a>
<a class="sourceLine" id="cb32-3" title="3">For Each i In days             <span class="co">// 每次循环，变量i的值分别为days中的每个值 </span></a>
<a class="sourceLine" id="cb32-4" title="4">    count = count + i          <span class="co">// 把数组中的每个值依次加起来</span></a>
<a class="sourceLine" id="cb32-5" title="5">Next</a>
<a class="sourceLine" id="cb32-6" title="6">TracePrint(count)              <span class="co">// 这里会显示一年中每个月的天数的累加和，即365</span></a></code></pre></div>
</section>
<section class="level3" id="跳出语句">
<h3><span class="header-section-number">6.5.6</span> 跳出语句</h3>
<p>在UB语言中，支持以下形式的循环跳出语句：</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb33-1" title="1">Break</a></code></pre></div>
<p>只能出现在条件循环、计次循环或遍历循环等循环语句的内部语句块中，其含义是立即跳出当前循环。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb34-1" title="1">Continue</a></code></pre></div>
<p>只能出现在条件循环、计次循环或遍历循环等循环语句的内部语句块中，其含义是立即结束当前循环，并开始下一次循环。</p>
<p>例如：</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb35-1" title="1">Dim days = { '一月':<span class="dv">31</span>, '二月':<span class="dv">28</span>, '三月':<span class="dv">31</span>, </a>
<a class="sourceLine" id="cb35-2" title="2">             '四月':<span class="dv">30</span>, '五月':<span class="dv">31</span>, '六月':<span class="dv">30</span>, </a>
<a class="sourceLine" id="cb35-3" title="3">             '七月':<span class="dv">31</span>, '八月':<span class="dv">31</span>, '九月':<span class="dv">30</span>, </a>
<a class="sourceLine" id="cb35-4" title="4">             '十月':<span class="dv">31</span>, '十一月':<span class="dv">30</span>, '十二月':<span class="dv">31</span> }  <span class="co">// 定义字典型变量days</span></a>
<a class="sourceLine" id="cb35-5" title="5"></a>
<a class="sourceLine" id="cb35-6" title="6">For Each i,j In days            <span class="co">// 每次循环，变量i, j分别为days中每个名字和值</span></a>
<a class="sourceLine" id="cb35-7" title="7">    If j Mod <span class="dv">2</span> = <span class="dv">0</span>              <span class="co">// 如果j是偶数</span></a>
<a class="sourceLine" id="cb35-8" title="8">           Continue             <span class="co">// 结束本次循环，开始下一次循环</span></a>
<a class="sourceLine" id="cb35-9" title="9">    End If</a>
<a class="sourceLine" id="cb35-10" title="10">    TracePrint(i)               <span class="co">// 把days中的名字（其值不是偶数）显示出来</span></a>
<a class="sourceLine" id="cb35-11" title="11">Next</a></code></pre></div>
<p>另外，在流程块中的任何地方，只需要书写</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb36-1" title="1">Exit</a></code></pre></div>
<p>不需要任何参数，即可在执行到此行的时候，自动结束整个流程（不是当前流程块）的执行。</p>
</section>
</section>
<section class="level2" id="函数">
<h2><span class="header-section-number">6.6</span> 函数</h2>
<p>所谓函数，是指把一组常用的功能包装成一个语句块（称之为“定义”），并且可以在其他语句中运行这个语句块（称之为“调用”）。使用函数可以有效的梳理逻辑，以及避免重复代码的编写。</p>
<p>函数的定义和调用没有先后关系，可以先出现调用，再出现定义。但函数必须定义在全局空间中，也就是说，函数定义不能出现在其他函数定义、分支语句、循环语句下面的语句块中。</p>
<p>函数定义中可以包含参数，参数相当于是一个变量，但在调用时，可以由调用者指定这些变量的值。</p>
<p>定义函数的格式如下：</p>
<ul>
<li>无参数的函数</li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb37-1" title="1">Function 函数名( )</a>
<a class="sourceLine" id="cb37-2" title="2">    语句块</a>
<a class="sourceLine" id="cb37-3" title="3">End Function</a></code></pre></div>
<ul>
<li>有参数的函数</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb38-1" title="1">Function 函数名(参数定义1, 参数定义2)</a>
<a class="sourceLine" id="cb38-2" title="2">    语句块</a>
<a class="sourceLine" id="cb38-3" title="3">End Function</a></code></pre></div>
<p>其中，参数定义的格式可以只是一个<code>变量名</code>，也可以是<code>变量名 = 表达式</code>的形式。对于后者来说，表示这个参数带有一个“默认值”，其默认值由“表达式”来确定。</p>
<p>如果函数有参数，则参数中的每个变量名都被认为是此函数内已经定义好的局部变量，无需使用<code>Dim</code>语句定义。</p>
<p>在函数定义中，要退出函数并返回，采用以下写法：</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb39-1" title="1">Return 返回值</a></code></pre></div>
<p>当执行到这一语句时，将跳出函数并返回到调用语句的下一行。返回的时候可以带一个返回值（具体作用下文叙述）。返回值可以忽略，默认为<code>Null</code>。当执行到函数末尾的时候，无论有没有写<code>Return</code>语句，都会返回。</p>
<p>例如：</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb40-1" title="1">Function Add(x, y=<span class="dv">1</span>)        <span class="co">// 定义了两个参数的函数，第二个参数有默认值</span></a>
<a class="sourceLine" id="cb40-2" title="2">    Return x + y            <span class="co">// 返回值为x+y的值</span></a>
<a class="sourceLine" id="cb40-3" title="3">End Function</a></code></pre></div>
<p>调用函数的格式如下：</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb41-1" title="1">返回 = 函数名(表达式1, 表达式2)</a></code></pre></div>
<p>或者</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb42-1" title="1">函数名(表达式1，表达式2)</a></code></pre></div>
<p>按照第一种格式调用，可以指定一个变量作为返回，当函数调用完成后，函数的返回值会自动赋值给这里的返回变量，调用者可以通过返回值，了解到函数调用的情况。此时，必须在被调用的函数名后面加圆括号。而当按照第二种格式调用时，调用者不需要返回值，则可以省略圆括号，使语句更符合自然语言习惯。</p>
<p>当调用时，相当于对函数中的参数进行了一次赋值运算，用表达式的值对其赋值。与赋值运算的规则相同，当表达式为一个独立的（没有使用任何运算符计算）数组、字典时，赋值操作只赋值其引用，也就是说，只是为变量增加一个“别名”。</p>
<p>调用函数时，传入的表达式的数量可以少于参数的数量。如果某个参数没有传入值，或者传入值为<code>Null</code>，则采用其默认值。没有默认值的参数，调用函数时必须传入值或者表达式。</p>
<p>例如，对于上面定义的函数，可以按照如下的方式调用：</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb43-1" title="1">a = Add(<span class="dv">100</span>)            <span class="co">// 调用Add函数，第二个参数取默认值1，所以a的值是101</span></a>
<a class="sourceLine" id="cb43-2" title="2">b = Add(<span class="dv">100</span>, <span class="dv">200</span>)       <span class="co">// 调用Add函数，指定了两个参数，所以b的值是300</span></a>
<a class="sourceLine" id="cb43-3" title="3">Add <span class="dv">100</span>, <span class="dv">200</span>            <span class="co">// 调用Add函数，不关心返回值，所以可以不写括号</span></a></code></pre></div>
<p>当函数定义完成后，其名称可以作为一个函数类型的常量使用，也可以把函数名称赋值给某个变量，用这个变量也可以调用这个函数。</p>
<p>例如，对于上面定义的函数<code>Add</code>，可以按照如下的方式使用：</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb44-1" title="1">Dim Plus = Add</a>
<a class="sourceLine" id="cb44-2" title="2">TracePrint Plus(<span class="dv">100</span>, <span class="dv">200</span>)</a>
<a class="sourceLine" id="cb44-3" title="3"><span class="co">// 相当于先调用了Add函数，再用其返回值调用了TracePrint函数，结果是300</span></a></code></pre></div>
<p>除了在流程块中定义的函数之外，UB语言中的各种命令实际上就是内置的函数。比如上面例子中的<code>TracePrint</code>就是一个内置函数，同时也是一条命令。所以，在使用<code>TracePrint</code>命令的时候，以下两种方式都是可以的：</p>
<ul>
<li><code>TracePrint("Hello")</code></li>
<li><code>TracePrint "Hello"</code></li>
</ul>
<p>请注意：“函数”和“参数”的称呼符合一般编程语言的习惯。但为了更好地让非IT人员理解，我们在UiBot软件本身中多采用“子程序”和“属性”的称呼，来指代“函数”和“参数”。但在本章中，由于介绍的是UB语言，所以仍然维持与其他编程语言一致的习惯，称为“函数”和“参数”。</p>
</section>
<section class="level2" id="其他">
<h2><span class="header-section-number">6.7</span> 其他</h2>
<section class="level3" id="多模块">
<h3><span class="header-section-number">6.7.1</span> 多模块</h3>
<p>UB语言支持多模块，可以在UB语言中，调用另一个用UB语言编写的流程块。虽然UB语言并未规定扩展名，但如果要调用另一个UB语言的流程块，则两个流程块需要有相同的扩展名。</p>
<p>我们把被调用的流程块称为“模块”，则去掉扩展名以后，剩下的文件名就是模块的名字。比如某个流程块的文件名为UBTest.task，则其模块名为UBTest。</p>
<p>在UB语言中，采用以下方式导入一个模块：</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb45-1" title="1">Import 模块名</a></code></pre></div>
<p>注意这里的模块名的书写规则和变量名一致，不需要采用双引号，也不需要加扩展名。如Import UBTest。UiBot在编译和运行时会自动按照当前流程块文件的扩展名，为其补充扩展名，并在当前目录下查找。在Windows中，由于文件名不区分大小写，所以Import语句后面的模块名也可以不区分大小写。在其他操作系统中，需要注意模块名的大小写要和文件一致。</p>
<p>每个导入的模块，都会被放置在一个与模块名同名的“命名空间”中，可以通过下面这种方式来调用导入模块中的函数：</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb46-1" title="1">命名空间.函数名</a></code></pre></div>
<p>即在命名空间和函数名之间加一个点号（.）进行分隔。</p>
<p>导入一个模块之后，既可以调用模块中定义的函数，又可以直接以模块名作为函数名，直接运行这个流程块中的所有命令。例如，有一个流程块 ABC.task。在其他流程块中Import之后，直接采用下面的格式即可直接调用ABC.task（相当于运行了ABC.task这个流程块）：</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb47-1" title="1">ABC()</a></code></pre></div>
<p>假设流程块 ABC.task中定义了一个函数，名为test，则可以采用下面的格式调用这个函数</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb48-1" title="1">ABC.test()</a></code></pre></div>
</section>
<section class="level3" id="异常">
<h3><span class="header-section-number">6.7.2</span> 异常</h3>
<p>作为动态类型语言，有很多错误在编译时难以检查，只能在运行时报错。而且，由于UiBot不强调运行速度，而更强调运行的稳定性，也会在运行时加入比较多的检查。当出错的时候，比较合适的报错手段是抛出异常。 比如，对于界面元素自动化中的“有目标命令”，在运行的时候，如果到了超时时间都不能找到目标，就会自动抛出一个异常。</p>
<p>除了自动抛出的异常之外，在流程块中，还可以采用<code>Throw</code>语句抛出一个异常：</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb49-1" title="1">Throw 字符串</a></code></pre></div>
<p>在抛出异常时，可以把异常相关信息以字符串的形式一起抛出，也可以省略这个字符串。</p>
<p>如果在流程块中没有对异常进行处理，当出现异常时，整个流程都会终止执行，并且把异常相关信息显示出来。如下图所示：</p>
<figure>
<img alt="流程运行的时候出现异常" src="../../doc/guide/d2/media/file113.png" style="width:80.0%"><figcaption>流程运行的时候出现异常</figcaption>
</figure>
<p>如果不希望流程在发生异常的时候终止，可以采用以下语句对异常进行处理：</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb50-1" title="1">Try</a>
<a class="sourceLine" id="cb50-2" title="2">    语句块</a>
<a class="sourceLine" id="cb50-3" title="3">Catch 变量名</a>
<a class="sourceLine" id="cb50-4" title="4">    语句块</a>
<a class="sourceLine" id="cb50-5" title="5">Else</a>
<a class="sourceLine" id="cb50-6" title="6">    语句块</a>
<a class="sourceLine" id="cb50-7" title="7">End Try</a></code></pre></div>
<p>如果在<code>Try</code>后面的语句块中发生了异常，会跳到<code>Catch</code>后面的语句块中执行。如果在<code>Try</code>语句块中没有发生异常，且定义了<code>Else</code>语句块（当然，也可以省略<code>Else</code>语句块），则会跳到<code>Else</code>语句块中执行。</p>
<p><code>Catch</code>语句后面的变量名可以省略。如果不省略，可以不用<code>Dim</code>语句提前定义，当发生异常时，这个变量的值是一个字典，其中包含“File”、“Line”和“Message”三个字段，分别代表发生异常的文件名、发生异常的行号、异常包含的信息。</p>
<p>对于界面元素自动化来说，有的时候可能会因为界面卡顿等引起失败，实际上再试一次可能又正常了。因此，在<code>Try</code>语句后面，还可以加一个“重试次数”。如下所示：</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb51-1" title="1">Try N</a>
<a class="sourceLine" id="cb51-2" title="2">    语句块<span class="dv">1</span></a>
<a class="sourceLine" id="cb51-3" title="3">Catch 变量名</a>
<a class="sourceLine" id="cb51-4" title="4">    语句块<span class="dv">2</span></a>
<a class="sourceLine" id="cb51-5" title="5">Else</a>
<a class="sourceLine" id="cb51-6" title="6">    语句块<span class="dv">3</span></a>
<a class="sourceLine" id="cb51-7" title="7">End Try</a></code></pre></div>
<p>这里的<code>N</code>可以是变量、表达式或常量，但通常应为整数类型。其含义是：</p>
<p>在Try和Catch之间的语句（如上例中的“语句块1”），如果发生了异常，会自动回到Try的地方去重试，当重试<code>N</code>次之后，如果仍然有异常，才会跳到Catch后面的语句（如上例中的“语句块2”）去执行。 当在<code>N</code>次尝试中，只要有1次成功了，就不会再继续后面的尝试（比如第1次异常，第2次没有异常，就不会再试第3次了），而是跳到Else后面的语句（如上例中的“语句块3”）去执行。</p>
</section>
</section>
</section>

        </div>
    </div>
    <script src="../../tutorials/js/jquery.slim.min-1.js"></script>
    <script src="../../tutorials/js/popper.min-1.js"></script>
    <script src="../../tutorials/js/bootstrap.min-1.js"></script>
     <script>
        $(function () {
            // $('#toc a').prop('target', 'main');
            $('.toc a').click(function () {
                $('.toc a.active').removeClass('active');
                var self = $(this);
                if (!self.hasClass('active')) {
                    $(this).addClass('active')
                }
            })
            var hash = window.location.hash;
            if(hash) {
                hash = hash.substring(1);
                hash = decodeURIComponent(hash);
                console.log(hash);
                $('.toc a[href$="' +hash+'"]').addClass('active');
            }
        })
    </script>
</div></body>
</html>
